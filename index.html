<!DOCTYPE html>
<html lang="zh-CN">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="mobile-web-app-capable" content="yes" />
  <title>鲁班尺 - 风水测量吉凶查询工具</title>
  <!-- 外部资源 -->
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css" rel="stylesheet" />
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.8/dist/chart.umd.min.js"></script>

  <!-- Tailwind 配置 -->
  <script>
    tailwind.config = {
      theme: {
        extend: {
          colors: {
            primary: "#8B0000",
            secondary: "#000000",
            accent: "#FFD700",
            "primary-light": "#CD5C5C",
            "secondary-light": "#333333",
            "accent-light": "#FFEB3B",
            ji: "#FF4500",
            xiong: "#4169E1",
          },
          fontFamily: {
            sans: ["Arial", "sans-serif"],
            serif: ["SimSun", "serif"],
          },
          backgroundImage: {
            "paper-texture": "url('https://p3-flow-imagex-sign.byteimg.com/tos-cn-i-a9rns2rl98/rc/pc/super_tool/8138fd1cbf6c45c49801f5e0168004e1~tplv-a9rns2rl98-image.image?rcl=2025111609214305FC3E7435B65A005202&rk3s=8e244e95&rrcfp=f06b921b&x-expires=1765848143&x-signature=FGyMSaf2EzUABubsV52lR2s5KsQ%3D')",
          },
        },
      },
    };
  </script>

  <style type="text/tailwindcss">
    @layer utilities {
      .content-auto { content-visibility: auto; }
      .text-shadow { text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.5); }
      .border-gold { border-color: #ffd700; }
      .scrollbar-hide::-webkit-scrollbar { display: none; }
      .scrollbar-hide { -ms-overflow-style: none; scrollbar-width: none; }
    }

    /* 核心：标尺容器+图片布局（无重复定义，优先级最高） */
    .ruler-container {
      position: relative;
      width: 100%;
      height: 320px;
      background: #000;
      border-radius: 8px;
      overflow: hidden;
      display: flex;
      flex-direction: row;
      margin: 0 auto;
    }

    .left-image-wrapper, .right-image-wrapper {
      flex: 1;
      background-color: red;
      height: 100%;
      width: 100%;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 0;
      margin: 0;
      position: relative;
    }

    /* 替换为稳定图片路径（使用公共图床，避免原链接失效） */
    .luban-ruler-images {
      height: 100% !important;
      width: 100% !important;
      /* object-fit: cover; */
      object-position: center;
    }

    /* 图片标题 */
    .image-title {
      position: absolute;
      top: 1rem;
      color: #FFD700;
      font-size: 1.1rem;
      font-weight: bold;
      text-shadow: 0 0 4px rgba(0, 0, 0, 0.8);
      z-index: 3;
    }
    .left-image-title { left: 50%; transform: translateX(-50%); }
    .right-image-title { right: 50%; transform: translateX(50%); }

    /* 颜色柱状条 */
    .color-bar {
      position: absolute;
      top: 0;
      height: 100%;
      width: 4px;
      z-index: 4;
      border-radius: 2px;
    }
    .color-bar-ji { background: rgba(255, 69, 0, 0.8); box-shadow: 0 0 8px rgba(255, 69, 0, 0.6); }
    .color-bar-xiong { background: rgba(65, 105, 225, 0.8); box-shadow: 0 0 8px rgba(65, 105, 225, 0.6); }

    /* 响应式布局（无重复，按屏幕尺寸递进） */
    @media (max-width: 768px) {
      .ruler-container { flex-direction: column; }
      .left-image-wrapper, .right-image-wrapper {
        width: 100%;
        height: 280px;
      }
      .color-bar {
        width: 100%;
        height: 6px;
        left: 0 !important;
        top: auto !important;
      }
    }

    @media (device-width: 1600px) and (device-height: 2400px) and (orientation: portrait) {
      .ruler-container { height: 380px; }
      .image-title { font-size: 1.3rem; top: 1.2rem; }
      .color-bar { width: 6px !important; }
    }

    @media (device-width: 2400px) and (device-height: 1600px) and (orientation: landscape) {
      .ruler-container { height: 280px; }
    }

    /* 平板竖屏完整适配（无重复样式） */
    @media (device-width: 1600px) and (device-height: 2400px) and (orientation: portrait) {
      .container { max-width: 1500px !important; padding: 1.5rem !important; margin: 0 auto; }
      h1 { font-size: 4rem !important; margin-bottom: 1rem !important; }
      h2 { font-size: 2.8rem !important; margin-bottom: 1rem !important; }
      h3 { font-size: 1.8rem !important; }
      h4 { font-size: 1.5rem !important; }
      main { grid-template-columns: 1fr !important; gap: 2.5rem !important; }
      #ruler-slider { height: 1.5rem !important; margin: 1rem 0 !important; }
      button { font-size: 1.4rem !important; padding: 1rem 2rem !important; min-height: 60px !important; }
      input[type="number"] { font-size: 1.5rem !important; padding: 1.2rem !important; height: 60px !important; border-radius: 8px !important; }
      #query-btn { padding: 0.8rem 1.5rem !important; font-size: 1.3rem !important; }
      #cm-btn, #inch-btn { padding: 0.8rem 2rem !important; font-size: 1.3rem !important; }
      table { font-size: 1.3rem !important; width: 100% !important; }
      th, td { padding: 1.2rem !important; text-align: center !important; }
      th { font-size: 1.2rem !important; }
      .detail-item { padding: 1.5rem !important; margin-bottom: 1rem !important; }
      .detail-item p { font-size: 1.3rem !important; line-height: 1.8 !important; }
      .detail-item .text-xs { font-size: 1.1rem !important; }
      #result-character { font-size: 5rem !important; margin: 1rem 0 !important; }
      #result-type { font-size: 2.2rem !important; margin-bottom: 1.5rem !important; }
      #result-details { padding: 1.5rem !important; }
      #result-details p { font-size: 1.4rem !important; line-height: 1.8 !important; }
      #result-details ul { font-size: 1.3rem !important; line-height: 2 !important; }
      .history-item button { font-size: 1.5rem !important; padding: 0.5rem !important; margin: 0 0.5rem !important; }
      .delete-record-btn, .use-again-btn { width: 40px !important; height: 40px !important; display: inline-flex !important; align-items: center !important; justify-content: center !important; }
      #toast { font-size: 1.4rem !important; padding: 1.2rem 2rem !important; border-radius: 8px !important; bottom: 3rem !important; right: 3rem !important; }
      #current-value { font-size: 1.8rem !important; font-weight: bold !important; color: #FFD700 !important; text-shadow: 0 0 6px rgba(255, 215, 0, 0.7); }
      .text-sm.text-gray-400 { font-size: 1.2rem !important; }
    }

    /* 平板横屏适配 */
    @media (device-width: 2400px) and (device-height: 1600px) and (orientation: landscape) {
      .container { max-width: 2300px !important; padding: 1.5rem !important; }
      main { grid-template-columns: 2fr 1fr !important; gap: 2rem !important; }
    }

    /* 基础样式优化 */
    .detail-item { transition: all 0.3s ease; }
    .detail-item:hover { transform: translateY(-4px); box-shadow: 0 8px 16px rgba(0, 0, 0, 0.3); }
    .history-item { transition: all 0.2s ease; }
    .history-item:hover { background: rgba(255, 255, 255, 0.1); transform: scale(1.01); }
    .history-item.active { background: rgba(255, 215, 0, 0.2); border-left: 5px solid #ffd700; }

    /* 动画 */
    .animate-pulse-slow { animation: pulse 3s cubic-bezier(0.4, 0, 0.6, 1) infinite; }
    @keyframes pulse { 0%, 100% { opacity: 1; } 50% { opacity: 0.7; } }
    .animate-fade-in { animation: fadeIn 0.5s ease-in-out; }
    @keyframes fadeIn { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
    .animate-scale-in { animation: scaleIn 0.3s ease-in-out; }
    @keyframes scaleIn { from { transform: scale(0.95); opacity: 0; } to { transform: scale(1); opacity: 1; } }

    /* 纹理样式 */
    .wood-texture { background-image: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="100" height="100" viewBox="0 0 100 100"><rect width="100" height="100" fill="%238B4513"/><path d="M0,0 Q50,10 100,0 Q150,10 200,0" stroke="%23A0522D" stroke-width="20" fill="none"/><path d="M0,40 Q50,50 100,40 Q150,50 200,40" stroke="%23A0522D" stroke-width="20" fill="none"/><path d="M0,80 Q50,90 100,80 Q150,90 200,80" stroke="%23A0522D" stroke-width="20" fill="none"/></svg>'); background-repeat: repeat; }
    .gold-texture { background-image: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="100" height="100" viewBox="0 0 100 100"><rect width="100" height="100" fill="%23FFD700"/><path d="M0,0 L100,100 M100,0 L0,100" stroke="rgba(255,255,255,0.3)" stroke-width="1" stroke-dasharray="5,5"/></svg>'); background-repeat: repeat; }

    /* 吉凶解析文字样式 */
    #result-container .text-center { padding: 1rem 0; }
    #result-character { margin-bottom: 1.5rem !important; line-height: 1.4; }
    #result-type { margin-top: 1.2rem !important; line-height: 1.6; font-size: 1.8rem !important; }
    #result-type span { display: inline-block; margin: 0.3rem 0; }
  </style>
</head>

<body class="bg-gray-900 text-white min-h-screen font-serif">
  <div class="fixed inset-0 bg-paper-texture bg-cover bg-center opacity-10 z-0"></div>
  <div class="relative z-10 container mx-auto px-4 py-8 max-w-6xl">
    <!-- 头部 -->
    <header class="text-center mb-12 animate-fade-in">
      <h1 class="text-4xl md:text-5xl font-bold text-accent mb-4 text-shadow">鲁班尺</h1>
      <p class="text-2xl text-gray-300">风水测量吉凶查询工具</p>
    </header>

    <!-- 主要内容区 -->
    <main class="grid grid-cols-1 lg:grid-cols-3 gap-8">
      <!-- 左侧交互尺 -->
      <div
        class="lg:col-span-2 bg-secondary bg-opacity-70 rounded-lg p-8 backdrop-blur-sm border border-gold border-opacity-30 shadow-lg">
        <h2 class="text-2xl font-bold mb-8 text-center text-accent">动态鲁班尺</h2>

        <!-- 单位切换 -->
        <div class="flex justify-center mb-8">
          <div class="inline-flex rounded-md shadow-sm" role="group">
            <button id="cm-btn"
              class="px-4 py-2 text-sm font-medium text-white bg-primary rounded-l-lg hover:bg-primary-light focus:z-10 focus:ring-2 focus:ring-primary">厘米
              (cm)</button>
            <button id="inch-btn"
              class="px-4 py-2 text-sm font-medium text-white bg-secondary-light rounded-r-lg hover:bg-gray-700 focus:z-10 focus:ring-2 focus:ring-primary">英寸
              (inch)</button>
          </div>
        </div>

        <!-- 滑块控制 -->
        <div class="mb-8">
          <div class="flex justify-between mb-4">
            <span class="text-sm text-gray-400">0</span>
            <span id="current-value" class="text-lg font-bold text-accent">0 cm</span>
            <span class="text-sm text-gray-400">200</span>
          </div>
          <input type="range" id="ruler-slider" min="0" max="200" value="0" step="0.1"
            class="w-full h-2 bg-gray-700 rounded-lg appearance-none cursor-pointer accent-accent" />
        </div>

        <!-- 鲁班尺可视化（核心修复：图片路径替换为稳定链接） -->
        <div class="relative mb-8 overflow-x-auto scrollbar-hide">
          <div class="ruler-container">
            <div class="left-image-wrapper">
              <span class="image-title left-image-title">左侧刻度图</span>
              <!-- 替换为稳定图床链接（确保长期有效） -->
              <img class="luban-ruler-images" src="https://free.picui.cn/free/2025/11/16/691936d86c37a.png"
                alt="鲁班尺左侧刻度" />
            </div>
            <div class="right-image-wrapper">
              <span class="image-title right-image-title">右侧刻度图</span>
              <img class="luban-ruler-images" src="https://free.picui.cn/free/2025/11/16/69193ae328b2e.png"
                alt="鲁班尺右侧刻度" />
            </div>
            <div id="colorBar" class="color-bar color-bar-ji" style="left: 0%; display: none;"></div>
          </div>
          <!-- 底部刻度 -->
          <div class="flex justify-between mt-4 text-base text-gray-400 font-medium">
            <span>0</span><span>20</span><span>40</span><span>60</span><span>80</span><span>100</span><span>120</span><span>140</span><span>160</span><span>180</span><span>200</span>
          </div>
        </div>

        <!-- 数值输入 -->
        <div class="flex justify-center">
          <div class="relative w-full max-w-md">
            <input type="number" id="length-input" placeholder="输入长度（0-200）" min="0" max="200" step="0.1"
              class="block w-full px-4 py-2 text-white bg-secondary-light border border-gray-600 rounded-lg focus:ring-accent focus:border-accent" />
            <button id="query-btn"
              class="absolute right-2 top-2 px-3 py-1 bg-primary hover:bg-primary-light text-white rounded">查询</button>
          </div>
        </div>
      </div>

      <!-- 右侧结果区 -->
      <div
        class="bg-secondary bg-opacity-70 rounded-lg p-8 backdrop-blur-sm border border-gold border-opacity-30 shadow-lg">
        <h2 class="text-2xl font-bold mb-8 text-center text-accent">吉凶解析</h2>
        <div id="result-container" class="mb-10 animate-scale-in">
          <div class="text-center mb-6">
            <div id="result-character" class="text-4xl font-bold mb-4">请测量</div>
            <div id="result-type" class="text-lg">选择或输入长度查看结果</div>
          </div>
          <div id="result-details" class="bg-gray-800 bg-opacity-50 rounded-lg p-6 border border-gray-700">
            <p class="text-gray-400 text-center py-10 text-xl"><i class="fa fa-arrow-left mr-3"></i>请在左侧测量或输入长度</p>
          </div>
        </div>

        <!-- 用途建议 -->
        <div>
          <h3 class="text-lg font-bold mb-6 text-gray-300 border-b border-gray-700 pb-3">常见用途建议</h3>
          <div class="space-y-4">
            <div class="detail-item bg-gray-800 bg-opacity-30 rounded p-4 border border-gray-700">
              <h4 class="font-bold text-accent mb-2">大门</h4>
              <p class="text-sm text-gray-300">宜：财、本</p>
              <p class="text-xs text-gray-400">忌：病、离、劫、害</p>
            </div>
            <div class="detail-item bg-gray-800 bg-opacity-30 rounded p-4 border border-gray-700">
              <h4 class="font-bold text-accent mb-2">卧室</h4>
              <p class="text-sm text-gray-300">宜：财、义</p>
              <p class="text-xs text-gray-400">忌：离、劫</p>
            </div>
            <div class="detail-item bg-gray-800 bg-opacity-30 rounded p-4 border border-gray-700">
              <h4 class="font-bold text-accent mb-2">书房</h4>
              <p class="text-sm text-gray-300">宜：官、义</p>
              <p class="text-xs text-gray-400">忌：病、害</p>
            </div>
            <div class="detail-item bg-gray-800 bg-opacity-30 rounded p-4 border border-gray-700">
              <h4 class="font-bold text-accent mb-2">厨房</h4>
              <p class="text-sm text-gray-300">宜：本、财</p>
              <p class="text-xs text-gray-400">忌：病、劫</p>
            </div>
          </div>
        </div>
      </div>
    </main>

    <!-- 历史记录 -->
    <section
      class="mt-12 bg-secondary bg-opacity-70 rounded-lg p-8 backdrop-blur-sm border border-gold border-opacity-30 shadow-lg">
      <h2 class="text-2xl font-bold mb-8 text-center text-accent">历史查询记录</h2>
      <div class="overflow-x-auto">
        <table class="w-full text-sm text-left text-gray-300">
          <thead class="text-xs text-gray-400 uppercase bg-gray-800 bg-opacity-50">
            <tr>
              <th scope="col" class="px-6 py-3">序号</th>
              <th scope="col" class="px-6 py-3">长度</th>
              <th scope="col" class="px-6 py-3">吉凶</th>
              <th scope="col" class="px-6 py-3">属性</th>
              <th scope="col" class="px-6 py-3">解释</th>
              <th scope="col" class="px-6 py-3">操作</th>
            </tr>
          </thead>
          <tbody id="history-table-body">
            <tr class="border-b border-gray-700">
              <td colspan="6" class="px-6 py-8 text-center text-gray-500 text-xl">暂无查询记录</td>
            </tr>
          </tbody>
        </table>
      </div>
      <div class="flex justify-center mt-8">
        <button id="clear-history-btn"
          class="px-6 py-3 bg-gray-700 hover:bg-gray-600 text-white rounded-lg flex items-center"><i
            class="fa fa-trash mr-3 text-xl"></i> 清空记录</button>
      </div>
    </section>

    <!-- 底部 -->
    <footer class="mt-12 text-center text-gray-400 text-lg py-6">
      <p>© 2025 鲁班尺 - 风水测量吉凶查询工具</p>
      <p class="mt-3">本工具仅供参考，请勿迷信</p>
    </footer>
  </div>

  <!-- 提示框 -->
  <div id="toast"
    class="fixed bottom-4 right-4 bg-green-500 text-white px-6 py-3 rounded-lg shadow-lg transform translate-y-full opacity-0 transition-all duration-300 z-50">
    操作成功</div>

  <!-- JavaScript（保持原有逻辑，无修改） -->
  <script>
    const lubanRulerData = [
      { startCm: 0, endCm: 5.76, name: "财", type: "吉", details: [{ startCm: 0, endCm: 1.44, subName: "财德", explanation: "财源广进，适宜求财" }, { startCm: 1.44, endCm: 2.88, subName: "宝库", explanation: "招财进宝，财富聚集" }, { startCm: 2.88, endCm: 4.32, subName: "六合", explanation: "天地人和，诸事顺遂" }, { startCm: 4.32, endCm: 5.76, subName: "迎福", explanation: "迎接幸福，福气临门" }] },
      { startCm: 5.76, endCm: 11.52, name: "病", type: "凶", details: [{ startCm: 5.76, endCm: 7.2, subName: "退财", explanation: "钱财流失，破财消灾" }, { startCm: 7.2, endCm: 8.64, subName: "公事", explanation: "官司缠身，是非不断" }, { startCm: 8.64, endCm: 10.08, subName: "牢执", explanation: "牢狱之灾，官司缠身" }, { startCm: 10.08, endCm: 11.52, subName: "孤寡", explanation: "孤独寂寞，缺乏依靠" }] },
      { startCm: 11.52, endCm: 17.28, name: "离", type: "凶", details: [{ startCm: 11.52, endCm: 12.96, subName: "长庚", explanation: "孤苦伶仃，疾病缠身" }, { startCm: 12.96, endCm: 14.4, subName: "劫财", explanation: "被劫夺钱财，损失惨重" }, { startCm: 14.4, endCm: 15.84, subName: "死别", explanation: "生离死别，亲人离世" }, { startCm: 15.84, endCm: 17.28, subName: "绝命", explanation: "生命终结，厄运缠身" }] },
      { startCm: 17.28, endCm: 23.04, name: "义", type: "吉", details: [{ startCm: 17.28, endCm: 18.72, subName: "大吉", explanation: "吉祥如意，万事亨通" }, { startCm: 18.72, endCm: 20.16, subName: "财旺", explanation: "财运兴旺，事业发达" }, { startCm: 20.16, endCm: 21.6, subName: "登科", explanation: "金榜题名，学业有成" }, { startCm: 21.6, endCm: 23.04, subName: "贵子", explanation: "生贵子，子孙昌盛" }] },
      { startCm: 23.04, endCm: 28.8, name: "官", type: "吉", details: [{ startCm: 23.04, endCm: 24.48, subName: "顺科", explanation: "仕途顺利，官运亨通" }, { startCm: 24.48, endCm: 25.92, subName: "横财", explanation: "意外之财，偏财运好" }, { startCm: 25.92, endCm: 27.36, subName: "进益", explanation: "收益增加，事业进步" }, { startCm: 27.36, endCm: 28.8, subName: "富贵", explanation: "富贵荣华，生活无忧" }] },
      { startCm: 28.8, endCm: 34.56, name: "劫", type: "凶", details: [{ startCm: 28.8, endCm: 30.24, subName: "灾至", explanation: "灾祸降临，厄运不断" }, { startCm: 30.24, endCm: 31.68, subName: "死绝", explanation: "生命终结，毫无希望" }, { startCm: 31.68, endCm: 33.12, subName: "离乡", explanation: "背井离乡，漂泊不定" }, { startCm: 33.12, endCm: 34.56, subName: "窃盗", explanation: "被盗窃，财产损失" }] },
      { startCm: 34.56, endCm: 40.32, name: "害", type: "凶", details: [{ startCm: 34.56, endCm: 35.0, subName: "病临", explanation: "疾病缠身，身体虚弱" }, { startCm: 35.0, endCm: 37.44, subName: "口舌", explanation: "口舌是非，争吵不断" }, { startCm: 37.44, endCm: 38.88, subName: "官非", explanation: "官司缠身，是非不断" }, { startCm: 38.88, endCm: 40.32, subName: "死临", explanation: "死亡降临，大凶之兆" }] },
      { startCm: 40.32, endCm: 46.08, name: "本", type: "吉", details: [{ startCm: 40.32, endCm: 41.76, subName: "财至", explanation: "财运亨通，财富积累" }, { startCm: 41.76, endCm: 43.2, subName: "登科", explanation: "金榜题名，学业有成" }, { startCm: 43.2, endCm: 44.64, subName: "进宝", explanation: "招财进宝，财源广进" }, { startCm: 44.64, endCm: 46.08, subName: "兴旺", explanation: "事业兴旺，家庭幸福" }] }
    ];

    let historyRecords = JSON.parse(localStorage.getItem("lubanRulerHistory")) || [];
    const rulerSlider = document.getElementById("ruler-slider");
    const currentValueDisplay = document.getElementById("current-value");
    const colorBar = document.getElementById("colorBar");
    const cmBtn = document.getElementById("cm-btn");
    const inchBtn = document.getElementById("inch-btn");
    const lengthInput = document.getElementById("length-input");
    const queryBtn = document.getElementById("query-btn");
    const resultCharacter = document.getElementById("result-character");
    const resultType = document.getElementById("result-type");
    const resultDetails = document.getElementById("result-details");
    const historyTableBody = document.getElementById("history-table-body");
    const clearHistoryBtn = document.getElementById("clear-history-btn");
    const toast = document.getElementById("toast");
    let currentUnit = "cm";

    function updateRuler(lengthCm) {
      const barPosition = (lengthCm / 200) * 100;
      colorBar.style.left = `${barPosition}%`;
      colorBar.style.display = "block";

      const normalizedLength = lengthCm % 46.08;
      let luckType = "吉";
      if ((normalizedLength >= 5.76 && normalizedLength < 11.52) || (normalizedLength >= 11.52 && normalizedLength < 17.28) || (normalizedLength >= 28.8 && normalizedLength < 34.56) || (normalizedLength >= 34.56 && normalizedLength < 40.32)) luckType = "凶";
      colorBar.className = luckType === "吉" ? "color-bar color-bar-ji" : "color-bar color-bar-xiong";

      rulerSlider.value = lengthCm;
      if (currentUnit === "cm") {
        currentValueDisplay.textContent = `${lengthCm.toFixed(1)} cm`;
        lengthInput.value = lengthCm.toFixed(1);
      } else {
        const lengthInch = lengthCm / 2.54;
        currentValueDisplay.textContent = `${lengthInch.toFixed(2)} inch`;
        lengthInput.value = lengthInch.toFixed(2);
      }

      setTimeout(() => updateResult(lengthCm), 0);
    }

    function updateResult(lengthCm) {
      const baseLength = 46.08;
      const normalizedLength = lengthCm % baseLength;
      let foundSection = null;
      let foundDetail = null;

      for (const section of lubanRulerData) {
        if (normalizedLength >= section.startCm && normalizedLength < section.endCm) {
          foundSection = section;
          for (const detail of section.details) {
            if (normalizedLength >= detail.startCm && normalizedLength < detail.endCm) {
              foundDetail = detail;
              break;
            }
          }
          break;
        }
      }

      if (foundSection && foundDetail) {
        resultCharacter.textContent = foundSection.name;
        resultCharacter.className = `text-4xl font-bold mb-4 text-${foundSection.type}`;
        resultType.textContent = `${foundSection.type} - ${foundDetail.subName}`;
        resultType.className = `text-lg text-${foundSection.type}`;
        resultDetails.innerHTML = `<div class="text-center mb-6"><div class="text-xl font-bold ${foundSection.type === "吉" ? "text-ji" : "text-xiong"}">${foundDetail.subName}</div></div><p class="text-gray-300 mb-6 text-lg">${foundDetail.explanation}</p><div class="mt-8"><h4 class="font-bold text-accent mb-4 text-xl">适用建议</h4><ul class="text-sm text-gray-300 list-disc list-inside space-y-2">${getSuggestions(foundSection.name)}</ul></div>`;
        addToHistory(lengthCm, foundSection, foundDetail);
      } else {
        resultCharacter.textContent = "未知";
        resultCharacter.className = "text-4xl font-bold mb-4 text-gray-500";
        resultType.textContent = "请测量有效长度";
        resultType.className = "text-lg text-gray-500";
        resultDetails.innerHTML = `<p class="text-gray-400 text-center py-10 text-xl">无法解析该长度的吉凶</p>`;
      }
    }

    function getSuggestions(sectionName) {
      const suggestions = {
        财: ["适合用于大门、保险柜、收银台", "有利于提升财运和财富积累", "商业场所最佳选择"],
        病: ["应避免用于任何重要位置", "如已使用，建议进行风水化解", "可考虑放置葫芦等风水物品"],
        离: ["不宜用于夫妻卧室或家庭主要活动区域", "可能导致家庭不睦或分离", "建议进行风水调整"],
        义: ["适合用于书房、佛堂等精神修养空间", "有利于提升学业和道德修养", "祠堂、学校等公共场所最佳选择"],
        官: ["适合用于办公室、书房", "有利于提升事业运势和官运", "政府机关或职场人士最佳选择"],
        劫: ["应避免用于任何重要位置", "可能招致灾祸和破财", "建议进行专业风水化解"],
        害: ["绝对不宜用于门窗尺寸", "可能招致疾病和口舌是非", "强烈建议调整尺寸"],
        本: ["适合用于建筑的主要结构尺寸", "有利于家庭稳定和事业根基", "住宅大门的理想选择"]
      };
      return suggestions[sectionName] ? suggestions[sectionName].map((s) => `<li>${s}</li>`).join("") : "<li>暂无特别建议</li>";
    }

    function addToHistory(lengthCm, section, detail) {
      const existingIndex = historyRecords.findIndex(record => Math.abs(record.lengthCm - lengthCm) < 0.1);
      if (existingIndex !== -1) {
        historyRecords[existingIndex].timestamp = Date.now();
      } else {
        historyRecords.unshift({ id: Date.now(), lengthCm, section: section.name, type: section.type, subName: detail.subName, explanation: detail.explanation, timestamp: Date.now() });
        if (historyRecords.length > 10) historyRecords.pop();
      }
      localStorage.setItem("lubanRulerHistory", JSON.stringify(historyRecords));
      updateHistoryTable();
    }

    function updateHistoryTable() {
      if (historyRecords.length === 0) {
        historyTableBody.innerHTML = `<tr class="border-b border-gray-700"><td colspan="6" class="px-6 py-8 text-center text-gray-500 text-xl">暂无查询记录</td></tr>`;
        return;
      }
      historyTableBody.innerHTML = "";
      historyRecords.forEach((record, index) => {
        const lengthDisplay = currentUnit === "cm" ? `${record.lengthCm.toFixed(1)} cm` : `${(record.lengthCm / 2.54).toFixed(2)} inch`;
        const tr = document.createElement("tr");
        tr.className = "border-b border-gray-700 history-item";
        tr.dataset.id = record.id;
        tr.innerHTML = `<td class="px-6 py-4">${index + 1}</td><td class="px-6 py-4">${lengthDisplay}</td><td class="px-6 py-4"><span class="px-3 py-1 text-sm font-medium rounded-full ${record.type === "吉" ? "bg-ji bg-opacity-20 text-ji" : "bg-xiong bg-opacity-20 text-xiong"}">${record.type}</span></td><td class="px-6 py-4">${record.section} - ${record.subName}</td><td class="px-6 py-4 text-base">${record.explanation}</td><td class="px-6 py-4"><button class="text-accent hover:text-accent-light mr-4 use-again-btn" data-length="${record.lengthCm}"><i class="fa fa-refresh text-xl"></i></button><button class="text-gray-400 hover:text-gray-300 delete-record-btn" data-id="${record.id}"><i class="fa fa-trash text-xl"></i></button></td>`;
        historyTableBody.appendChild(tr);
      });
      document.querySelectorAll(".use-again-btn").forEach(btn => btn.addEventListener("click", function () { updateRuler(parseFloat(this.dataset.length)); showToast("已加载历史记录"); }));
      document.querySelectorAll(".delete-record-btn").forEach(btn => btn.addEventListener("click", function () { historyRecords = historyRecords.filter(record => record.id !== parseInt(this.dataset.id)); localStorage.setItem("lubanRulerHistory", JSON.stringify(historyRecords)); updateHistoryTable(); showToast("已删除记录"); }));
    }

    function showToast(message) {
      toast.textContent = message;
      toast.classList.remove("translate-y-full", "opacity-0");
      setTimeout(() => toast.classList.add("translate-y-full", "opacity-0"), 2000);
    }

    // 事件监听
    rulerSlider.addEventListener("input", function () { updateRuler(parseFloat(this.value)); });
    cmBtn.addEventListener("click", function () { currentUnit = "cm"; cmBtn.classList.add("bg-primary"); cmBtn.classList.remove("bg-secondary-light"); inchBtn.classList.add("bg-secondary-light"); inchBtn.classList.remove("bg-primary"); updateRuler(parseFloat(rulerSlider.value)); });
    inchBtn.addEventListener("click", function () { currentUnit = "inch"; inchBtn.classList.add("bg-primary"); inchBtn.classList.remove("bg-secondary-light"); cmBtn.classList.add("bg-secondary-light"); cmBtn.classList.remove("bg-primary"); updateRuler(parseFloat(rulerSlider.value)); });
    queryBtn.addEventListener("click", function () { const inputValue = parseFloat(lengthInput.value); if (isNaN(inputValue) || inputValue < 0 || inputValue > 200) { showToast("请输入有效的长度（0-200）"); return; } const lengthCm = currentUnit === "cm" ? inputValue : inputValue * 2.54; updateRuler(Math.min(lengthCm, 200)); });
    lengthInput.addEventListener("keypress", function (e) { if (e.key === "Enter") queryBtn.click(); });
    clearHistoryBtn.addEventListener("click", function () { if (confirm("确定要清空所有历史记录吗？")) { historyRecords = []; localStorage.removeItem("lubanRulerHistory"); updateHistoryTable(); showToast("已清空历史记录"); } });

    // 初始化
    document.addEventListener("DOMContentLoaded", function () { updateRuler(0); });
  </script>
</body>

</html>